<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="algatr">
<title>Environmental data processing â€¢ algatr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Environmental data processing">
<meta property="og:description" content="algatr">
<meta property="og:image" content="https://thewanglab.github.io/algatr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">algatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference Manual</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/data_processing_vignette.html">Genetic data processing</a>
    <a class="dropdown-item" href="../articles/enviro_data_vignette.html">Environmental data processing</a>
    <a class="dropdown-item" href="../articles/masking_vignette.html">Masking</a>
    <a class="dropdown-item" href="../articles/gen_dist_vignette.html">Genetic distances</a>
    <a class="dropdown-item" href="../articles/TESS_vignette.html">TESS</a>
    <a class="dropdown-item" href="../articles/MMRR_vignette.html">MMRR</a>
    <a class="dropdown-item" href="../articles/GDM_vignette.html">GDM</a>
    <a class="dropdown-item" href="../articles/RDA_vignette.html">RDA</a>
    <a class="dropdown-item" href="../articles/LFMM_vignette.html">LFMM</a>
    <a class="dropdown-item" href="../articles/wingen_vignette.html">Wingen</a>
    <a class="dropdown-item" href="../articles/alazygatr_vignette.html">Alazygatr</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Environmental data processing</h1>
            
      
      
      <div class="d-none name"><code>enviro_data_vignette.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install packages</span></span>
<span><span class="fu"><a href="../reference/envirodata_packages.html">envirodata_packages</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="processing-environmental-data-for-landscape-genomics">Processing environmental data for landscape genomics<a class="anchor" aria-label="anchor" href="#processing-environmental-data-for-landscape-genomics"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://thewanglab.github.io/algatr/">algatr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bleutner.github.io/RStoolbox/" class="external-link">RStoolbox</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geodata</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">wingen</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></code></pre></div>
<p>For landscape genomic analyses, environmental data layers must be
processed in several ways before they can be used as input into methods.
This vignette will explore several ways to process environmental
data:</p>
<ul>
<li><p><code><a href="../reference/get_worldclim.html">get_worldclim()</a></code> to pull environmental layers
remotely from the WorldClim database</p></li>
<li>
<p>Detect collinearity:</p>
<ul>
<li><p><code><a href="../reference/check_env.html">check_env()</a></code> to detect collinearity between
environmental layers</p></li>
<li><p><code><a href="../reference/check_vals.html">check_vals()</a></code> to detect collinearity between
extracted environmental values</p></li>
<li><p><code><a href="../reference/check_dists.html">check_dists()</a></code> to detect collinearity between
geographic and environmental distances</p></li>
</ul>
</li>
<li><p><code><a href="https://rdrr.io/pkg/RStoolbox/man/rasterPCA.html" class="external-link">rasterPCA()</a></code> to perform a raster PCA on a stack of
environmental layers to reduce dimensionality</p></li>
<li><p><code><a href="https://rdrr.io/pkg/wingen/man/coords_to_raster.html" class="external-link">coords_to_raster()</a></code> to create a raster layer from
coordinate data (using the wingen package)</p></li>
<li><p><code><a href="../reference/env_dist.html">env_dist()</a></code> to calculate environmental
distances</p></li>
<li><p><code><a href="../reference/geo_dist.html">geo_dist()</a></code> to calculate geographic distances between
coordinates</p></li>
</ul>
<div class="section level4">
<h4 id="load-example-data">Load example data<a class="anchor" aria-label="anchor" href="#load-example-data"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_algatr_example.html">load_algatr_example</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; ---------------- example dataset ----------------</span></span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; </span> </span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt; Objects loaded:</span> </span></span>
<span><span class="co"><span style="color: #BBBB00; font-weight: bold;">#&gt; *liz_vcf*</span> <span style="color: #BBBB00;">vcfR object (1000 loci x 53 samples)</span> </span></span>
<span><span class="co"><span style="color: #BBBB00; font-weight: bold;">#&gt; *liz_gendist*</span> <span style="color: #BBBB00;">genetic distance matrix (Plink Distance)</span> </span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; *liz_coords*</span> <span style="color: #00BB00;">dataframe with x and y coordinates</span> </span></span>
<span><span class="co"><span style="color: #BB00BB; font-weight: bold;">#&gt; *CA_env*</span> <span style="color: #BB00BB;">RasterStack with example environmental layers</span> </span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; -------------------------------------------------</span></span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="introduction-to-environmental-data-files-and-object-types">Introduction to environmental data files and object types<a class="anchor" aria-label="anchor" href="#introduction-to-environmental-data-files-and-object-types"></a>
</h3>
<hr>
<p>Briefly, in R, any (geo)spatial data can be represented using points,
vectors, or rasters. Points represent coordinates. Vectors are used for
discrete phenomena that have clear boundaries (e.g., a country), while
rasters are used to represent continuous data (e.g., precipitation).
Rasters are able to represent continuous data by dividing up the
landscape into a grid of equally sized cells; each cell is then assigned
one (or more) values for relevant variables. In our case, taking
California as an example, points represent sampling coordinates, vectors
represent polygons (e.g., the state of California), and rasters store
different environmental layers (e.g.Â temperature, precipitation) for
California.</p>
<p>There are two main packages algatr uses to process and manipulate
environmental data: terra (<a href="https://cran.r-project.org/web/packages/terra/index.html" class="external-link">Hijmans
2022</a>) and raster (<a href="https://cran.r-project.org/web/packages/raster/index.html" class="external-link">Hijmans
2022</a>). Both of these packages have excellent resources and
walkthroughs (see <a href="https://rspatial.org/terra/" class="external-link">here</a> for
terra; see <a href="https://rspatial.org/raster/pkg/index.html" class="external-link">here</a>
for raster) that explain in depth environmental data processing and
manipulation in R.</p>
<p>Each of these packages has their own classes to represent rasters.
Within the terra package, the <code>SpatRaster</code> class is used to
represent rasters, while the raster package uses
<code>RasterLayer</code> (single-layer raster data),
<code>RasterBrick</code> and <code>RasterStack</code> (both are
multi-variable raster data but differ in how many files can be linked to
them) classes. No matter which class is used to represent rasters, the
fundamental parameters that describe these rasters are always the same:
numbers of rows, columns, the spatial extent, and the coordinate
reference system (CRS) for proper projection.</p>
<p>Ensuring that the CRS between your coordinates and raster layer is
particularly important. For all of algatrâ€™s methods, if no CRS is
provided, a warning will be generated but the respective method will run
assuming that the coordinates and raster CRS match; if the CRS between
these two inputs do not match, algatr will throw an error. Also keep in
mind that some methods cannot be performed with non-projected data (such
as kriging), so users must always transform their coordinates if theyâ€™re
in lat/long, for example. Refer to the wingen vignette (<a href="https://github.com/AnushaPB/wingen/blob/main/vignettes/wingen-vignette.Rmd" class="external-link">here</a>)
for further information how to convert lat/long coordinates to a
projected system.</p>
</div>
<div class="section level3">
<h3 id="gather-environmental-data-using-get_worldclim">Gather environmental data using <code>get_worldclim()</code><a class="anchor" aria-label="anchor" href="#gather-environmental-data-using-get_worldclim"></a>
</h3>
<hr>
<p>WorldClim is a database that provides environmental layers for the
entire globe (excluding Antarctica); the data contained are four monthly
variables and 18 bioclimatic variables, which are provided in tiles. The
<code><a href="../reference/get_worldclim.html">get_worldclim()</a></code> function retrieves and extracts WorldClim
data (using the <code><a href="https://rdrr.io/pkg/geodata/man/worldclim.html" class="external-link">worldclim_tile()</a></code> function in the geodata
package) from relevant tiles based on your sampling coordinates, drawing
a convex hull shape to connect all data points.</p>
<p>Users can add a buffer around sampling coordinates using the
<code>buff</code> argument, which corresponds to the proportion of the
spatial extent for the coordinates. Tile size (i.e., spatial resolution)
is specified using the <code>res</code> argument, which corresponds to
arc-minutes. The default is the 30s dataset (0.5 arc-mins), with a
buffer of 0.01.</p>
<p>Because <code>get_worldclim</code> can take some time, the following
code will not knit within the vignette but will give you an idea of how
to run the function with the example data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wclim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_worldclim.html">get_worldclim</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="va">liz_coords</span>, res <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># can set save_output = TRUE if you want a directory with files made</span></span></code></pre></div>
<p>Notice that <code>wclim</code> is a terra <code>SpatRaster</code>
object. Letâ€™s take a look at what this object looks like.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load wclim object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"wclim"</span><span class="op">)</span></span>
<span><span class="co"># Look at one of the layers, which corresponds to tile_15_wc2.1_30s_bio_1</span></span>
<span><span class="va">wclim</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; class      : RasterLayer </span></span>
<span><span class="co">#&gt; dimensions : 113, 120, 13560  (nrow, ncol, ncell)</span></span>
<span><span class="co">#&gt; resolution : 0.08333333, 0.08333333  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -125.25, -115.25, 32.58333, 42  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; source     : memory</span></span>
<span><span class="co">#&gt; names      : bio1 </span></span>
<span><span class="co">#&gt; values     : -1.311542, 24.08433  (min, max)</span></span></code></pre></div>
<p>Now, letâ€™s plot one of the variables and overlay our sampling
coordinates on top.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wclim</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">turbo</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">liz_coords</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/wclim%20plot-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="detecting-collinearity">Detecting collinearity<a class="anchor" aria-label="anchor" href="#detecting-collinearity"></a>
</h3>
<hr>
<p>An important first check for any landscape genomics analysis is to
detect collinearity between sets of variables. Specifically, we always
want to verify that there is no collinearity (within a given threshold)
between environmental layers (using <code><a href="../reference/check_env.html">check_env()</a></code>), extracted
values from environmental layers (using <code><a href="../reference/check_vals.html">check_vals()</a></code>), and
geographic and environmental distances (using
<code><a href="../reference/check_dists.html">check_dists()</a></code>) as many of the methods used for landscape
genomics assume that these variables are independent.</p>
<div class="section level4">
<h4 id="collinearity-among-environmental-layers">Collinearity among environmental layers<a class="anchor" aria-label="anchor" href="#collinearity-among-environmental-layers"></a>
</h4>
<p>The <code><a href="../reference/check_env.html">check_env()</a></code> function calculates the Pearson
correlation coefficient for pairwise comparisons of environmental
layers. The <code>threshold</code> is the correlation coefficient; it
defaults to 0.7. The output from this function is a list containing (1)
a dataframe of correlated environmental pairs that fall above the
threshold, and (2) a correlation matrix with all pairwise correlation
coefficients.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cors_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_env.html">check_env</a></span><span class="op">(</span><span class="va">wclim</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The extracted values for 19 pairs of variables had correlation coefficients &gt; 0.7. algatr recommends reducing collinearity by removing correlated variables or performing a PCA before proceeeding.</span></span>
<span><span class="co"># There are many pairs of layers that have correlation coefficients &gt; 0.7 (the default threshold)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For the sake of argument, we can also run this function on the CA_env object:</span></span>
<span><span class="fu"><a href="../reference/check_env.html">check_env</a></span><span class="op">(</span><span class="va">CA_env</span><span class="op">)</span></span>
<span><span class="co">#&gt; $cor_df</span></span>
<span><span class="co">#&gt; [1] var1 var2 r   </span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cor_matrix</span></span>
<span><span class="co">#&gt;              CA_rPCA1     CA_rPCA2     CA_rPCA3</span></span>
<span><span class="co">#&gt; CA_rPCA1 1.000000e+00 2.367727e-11 4.231118e-11</span></span>
<span><span class="co">#&gt; CA_rPCA2 2.367727e-11 1.000000e+00 3.888803e-11</span></span>
<span><span class="co">#&gt; CA_rPCA3 4.231118e-11 3.888803e-11 1.000000e+00</span></span>
<span><span class="co"># None of the pairwise comparisons exceed the threshold value</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="collinearity-among-extracted-environmental-values">Collinearity among extracted environmental values<a class="anchor" aria-label="anchor" href="#collinearity-among-extracted-environmental-values"></a>
</h4>
<p>Similar to the above, the <code><a href="../reference/check_vals.html">check_vals()</a></code> function
determines collinearity using Pearsonâ€™s correlation coefficients, but it
does so on extracted environmental variables at each of the sampling
coordinates. This will also generate a plot showing the pairwise
correlations between environmental variables.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Once again, we can see that there are many pairs of variables that exceed the threshold</span></span>
<span><span class="va">check_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_vals.html">check_vals</a></span><span class="op">(</span><span class="va">wclim</span>, <span class="va">liz_coords</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="co">#&gt; Warning: The extracted values for 25 pairs of variables had correlation coefficients &gt; 0.7. algatr recommends reducing collinearity by removing correlated variables or performing a PCA before proceeeding.</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/collin%20vals-1.png" width="960"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">check_result</span><span class="op">$</span><span class="va">cor_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   var1 var2         r</span></span>
<span><span class="co">#&gt; 1 bio2 bio4 0.7363230</span></span>
<span><span class="co">#&gt; 2 bio1 bio6 0.8829763</span></span>
<span><span class="co">#&gt; 3 bio2 bio7 0.8851769</span></span>
<span><span class="co">#&gt; 4 bio4 bio7 0.9640441</span></span>
<span><span class="co">#&gt; 5 bio1 bio8 0.9317171</span></span>
<span><span class="co">#&gt; 6 bio6 bio8 0.9761442</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check using the CA_env object; note that these values are quite different from those from check_env()</span></span>
<span><span class="fu"><a href="../reference/check_vals.html">check_vals</a></span><span class="op">(</span><span class="va">CA_env</span>, <span class="va">liz_coords</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/collin%20vals%20CA-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; $cor_df</span></span>
<span><span class="co">#&gt; [1] var1 var2 r   </span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cor_matrix</span></span>
<span><span class="co">#&gt;                  ID   CA_rPCA1   CA_rPCA2    CA_rPCA3</span></span>
<span><span class="co">#&gt; ID       1.00000000 0.20306375  0.1439392  0.04309331</span></span>
<span><span class="co">#&gt; CA_rPCA1 0.20306375 1.00000000  0.2095724  0.01194543</span></span>
<span><span class="co">#&gt; CA_rPCA2 0.14393920 0.20957242  1.0000000 -0.32015438</span></span>
<span><span class="co">#&gt; CA_rPCA3 0.04309331 0.01194543 -0.3201544  1.00000000</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="collinearity-between-distances">Collinearity between distances<a class="anchor" aria-label="anchor" href="#collinearity-between-distances"></a>
</h4>
<p>The <code><a href="../reference/check_dists.html">check_dists()</a></code> function determines collinearity
between geographic and environmental distances. It does so by extracting
values at sampling coordinates, and then calculating geographic and
environmental distances and runs a Mantel test on resulting distances.
Environmental distances are calculated using Euclidean distances, while
geographic distances can be Euclidean, topographic, or resistance
distances, though the default is Euclidean. The result of this function
is to output the p-value and Mantelâ€™s r and indicate which distances are
significantly correlated.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_dists.html">check_dists</a></span><span class="op">(</span><span class="va">wclim</span>, <span class="va">liz_coords</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="co">#&gt; Warning: The distances for 121 pairs of variables are significantly correlated. algatr recommends reducing collinearity by removing correlated variables or performing a PCA before proceeeding.</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">check_results</span><span class="op">$</span><span class="va">mantel_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   var1 var2    p         r</span></span>
<span><span class="co">#&gt; 1  geo bio2 0.01 0.1465585</span></span>
<span><span class="co">#&gt; 2 bio2 bio3 0.01 0.3687943</span></span>
<span><span class="co">#&gt; 3  geo bio4 0.02 0.1660475</span></span>
<span><span class="co">#&gt; 4 bio2 bio4 0.01 0.5724731</span></span>
<span><span class="co">#&gt; 5 bio3 bio4 0.01 0.8417016</span></span>
<span><span class="co">#&gt; 6 bio1 bio5 0.01 0.3036129</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can see that PC2 from CA_env and geo dists are significantly correlated!</span></span>
<span><span class="fu"><a href="../reference/check_dists.html">check_dists</a></span><span class="op">(</span><span class="va">CA_env</span>, <span class="va">liz_coords</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="co">#&gt; Warning: The distances for 2 pairs of variables are significantly correlated. algatr recommends reducing collinearity by removing correlated variables or performing a PCA before proceeeding.</span></span>
<span><span class="co">#&gt; $mantel_df</span></span>
<span><span class="co">#&gt;       var1     var2    p         r</span></span>
<span><span class="co">#&gt; 1      geo CA_rPCA2 0.01 0.2037404</span></span>
<span><span class="co">#&gt; 2 CA_rPCA2 CA_rPCA3 0.01 0.2544182</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $p</span></span>
<span><span class="co">#&gt;          [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; geo        NA 0.08 0.69 0.01 0.25</span></span>
<span><span class="co">#&gt; ID         NA   NA 0.72 0.11 0.10</span></span>
<span><span class="co">#&gt; CA_rPCA1   NA   NA   NA 0.45 0.88</span></span>
<span><span class="co">#&gt; CA_rPCA2   NA   NA   NA   NA 0.01</span></span>
<span><span class="co">#&gt; CA_rPCA3   NA   NA   NA   NA   NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $r</span></span>
<span><span class="co">#&gt;          [,1]      [,2]        [,3]        [,4]        [,5]</span></span>
<span><span class="co">#&gt; geo        NA 0.0724489 -0.01841863  0.20374038  0.04462286</span></span>
<span><span class="co">#&gt; ID         NA        NA -0.04253070  0.06336224  0.08223415</span></span>
<span><span class="co">#&gt; CA_rPCA1   NA        NA          NA -0.00798325 -0.07707443</span></span>
<span><span class="co">#&gt; CA_rPCA2   NA        NA          NA          NA  0.25441819</span></span>
<span><span class="co">#&gt; CA_rPCA3   NA        NA          NA          NA          NA</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="perform-a-raster-pca-on-environmental-layers">Perform a raster PCA on environmental layers<a class="anchor" aria-label="anchor" href="#perform-a-raster-pca-on-environmental-layers"></a>
</h3>
<hr>
<p>Because of collinearity issues, and because we may not want to deal
with dozens of environmental layers at a time, we can perform a PCA on
our rasters using the <code><a href="https://rdrr.io/pkg/RStoolbox/man/rasterPCA.html" class="external-link">rasterPCA()</a></code> function in the <a href="https://cran.r-project.org/web/packages/RStoolbox/index.html" class="external-link">RStoolbox
package</a>; this function can take in a <code>SpatRaster</code> or
<code>RasterStack</code> object. Letâ€™s use the <code>wclim</code> object
we generated above using the <code><a href="../reference/get_worldclim.html">get_worldclim()</a></code> function,
which contains 19 environmental variables. The result of this function
is a list containing the model information, and a RasterBrick object
containing multiple layers of PCA scores. One can also use the
<code>nComp</code> argument to only extract the top n PCs; in many
cases, the top three PCs may explain the majority of the variance of the
data, and so only those will be considered for further analyses.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env_pcs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RStoolbox/man/rasterPCA.html" class="external-link">rasterPCA</a></span><span class="op">(</span><span class="va">wclim</span>, spca <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's take a look at the results for the top three PCs</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/RStoolbox/man/ggR.html" class="external-link">ggR</a></span><span class="op">(</span><span class="va">env_pcs</span><span class="op">$</span><span class="va">map</span>, <span class="va">x</span>, geom_raster <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> </span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/raster%20PCA-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> </span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/raster%20PCA-2.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/raster%20PCA-3.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can also create a single composite raster plot with 3 PCs (each is assigned R, G, or B)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/RStoolbox/man/ggRGB.html" class="external-link">ggRGB</a></span><span class="op">(</span><span class="va">env_pcs</span><span class="op">$</span><span class="va">map</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, stretch <span class="op">=</span> <span class="st">"lin"</span>, q <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/comp%20raster-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="create-raster-from-coordinates-with-wingen-coords_to_raster">Create raster from coordinates with wingen:
<code>coords_to_raster()</code><a class="anchor" aria-label="anchor" href="#create-raster-from-coordinates-with-wingen-coords_to_raster"></a>
</h3>
<hr>
<p>In some cases, we may not have a raster already prepared. Using the
wingen package, we can use our coordinate data to generate a raster
given a user-specified buffer around sampling coordinates (using the
<code>buff</code> argument) and with a given resolution (using the
<code>res</code> argument). This raster does not have any meaningful
values assigned to it, but can be used to create maps of genetic
diversity in wingen (see the wingen documentation <a href="https://github.com/AnushaPB/wingen" class="external-link">here</a>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/wingen/man/coords_to_raster.html" class="external-link">coords_to_raster</a></span><span class="op">(</span><span class="va">liz_coords</span>, res <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">raster</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">liz_coords</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/coords%20to%20raster-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="calculate-environmental-distances-using-env_dist">Calculate environmental distances using <code>env_dist()</code><a class="anchor" aria-label="anchor" href="#calculate-environmental-distances-using-env_dist"></a>
</h3>
<hr>
<p>Some of the analyses within algatr, such as GDM and MMRR, require
comparing genetic distances to environmental distances. We can calculate
environmental distances using the <code><a href="../reference/env_dist.html">env_dist()</a></code> function,
which allows users to calculate environmental distances between
variables for given sampling locations. We first need to extract
environmental variables at sampling coordinates.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">CA_env</span>, <span class="va">liz_coords</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can there are extracted values (n=53) for each environmental layer</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span>
<span><span class="co">#&gt;       CA_rPCA1   CA_rPCA2    CA_rPCA3</span></span>
<span><span class="co">#&gt; [1,] -1.851397 -3.9385712 -0.71366495</span></span>
<span><span class="co">#&gt; [2,] -2.288577 -0.7470118 -0.05549845</span></span>
<span><span class="co">#&gt; [3,] -4.294456  4.4240017 -1.50788176</span></span>
<span><span class="co">#&gt; [4,] -1.916433 -3.7858098 -1.37762737</span></span>
<span><span class="co">#&gt; [5,] -1.942174  0.2111327  1.20659840</span></span>
<span><span class="co">#&gt; [6,] -2.463599  4.4038172 -2.02557206</span></span></code></pre></div>
<p>Now, weâ€™re ready to calculate environmental distances.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/env_dist.html">env_dist</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">env_dist</span><span class="op">$</span><span class="va">CA_rPCA1</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/env%20dist-1.png" width="700"></p>
<p>We can make a heat map in ggplot with the pairwise distances.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">env_dist</span><span class="op">$</span><span class="va">CA_rPCA1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="st">"sample"</span>, names_to <span class="op">=</span> <span class="st">"sample_comp"</span>, values_to <span class="op">=</span> <span class="st">"dist"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sample_comp</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/env%20dist%20heatmap-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="calculate-geographic-distances-using-geo_dist">Calculate geographic distances using <code>geo_dist()</code><a class="anchor" aria-label="anchor" href="#calculate-geographic-distances-using-geo_dist"></a>
</h3>
<hr>
<p>The <code><a href="../reference/geo_dist.html">geo_dist()</a></code> function allows users to choose from five
environmental distance metrics using the <code>type</code> argument:</p>
<ul>
<li><p>Geodesic distances (<code>"euclidean"</code> or
<code>"linear"</code>) using the geodist package (<a href="https://CRAN.R-project.org/package=geodist" class="external-link">Padgham &amp; Sumner
2021</a>)</p></li>
<li><p>Topographic distances (<code>"topo"</code> or
<code>"topographic"</code>) using the topoDistance package (<a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13317" class="external-link">Wang
2020</a>); requires a digital elevation model (DEM) raster specified
with the <code>lyr</code> argument</p></li>
<li><p>Resistance distances (<code>"resistance"</code>,
<code>"cost"</code>, or <code>"res"</code>) using the gdistance package
(<a href="https://www.jstatsoft.org/article/view/v076i13" class="external-link">van Etten
2017</a>); requires a resistance raster specified with the
<code>lyr</code> argument</p></li>
</ul>
<div class="section level4">
<h4 id="euclidean-distances">Euclidean distances<a class="anchor" aria-label="anchor" href="#euclidean-distances"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geo_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geo_dist.html">geo_dist</a></span><span class="op">(</span><span class="va">liz_coords</span>, type <span class="op">=</span> <span class="st">"Euclidean"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">geo_dist</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/geo%20dist-1.png" width="700"></p>
<p>We can make a heat map in ggplot with the pairwise distances.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a fun heat map with the pairwise distances</span></span>
<span><span class="va">geo_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">geo_dist</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">geo_dist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">geo_dist</span><span class="op">)</span></span>
<span><span class="va">geo_dist</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="st">"sample_comp"</span>, <span class="st">"dist"</span>, <span class="op">-</span><span class="st">"sample"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sample_comp</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/geo%20dist%20heatmap-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="topographic-distances">Topographic distances<a class="anchor" aria-label="anchor" href="#topographic-distances"></a>
</h4>
<p>We can also calculate topographic distances, but need to provide a
digital elevation model (DEM) raster to do so. We can retrieve a DEM
using the geodata package, cropping to California using the
<code>CA_env</code> object in our example dataset.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download the DEM raster using the elevation_30s function</span></span>
<span><span class="co"># This will save a .tif file in your current dir</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geodata/man/elevation.html" class="external-link">elevation_30s</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"USA"</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Crop to California limits</span></span>
<span><span class="va">CA_dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">dem</span>, <span class="va">CA_env</span><span class="op">)</span></span></code></pre></div>
<p>Take a look at what the DEM looks like, with samples plotted on
top.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">CA_dem</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">liz_coords</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/plot%20dem-1.png" width="700"></p>
<p>Now, letâ€™s calculate topographic distances using the
<code>CA_dem</code> object as our layer with the <code>lyr</code>
argument.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">topo_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geo_dist.html">geo_dist</a></span><span class="op">(</span><span class="va">liz_coords</span>, type <span class="op">=</span> <span class="st">"topo"</span>, lyr <span class="op">=</span> <span class="va">CA_dem</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calculating topo distances... This can be time consuming with many points and large rasters.</span></span></code></pre></div>
<p>Plot the resulting topographic distances as a heatmap.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a fun heat map with the pairwise distances</span></span>
<span><span class="va">topo_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">topo_dist</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">topo_dist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">53</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">topo_dist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">53</span></span>
<span></span>
<span><span class="va">topo_dist</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="st">"sample_comp"</span>, <span class="st">"dist"</span>, <span class="op">-</span><span class="st">"sample"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sample_comp</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span></span></code></pre></div>
<p><img src="enviro_data_vignette_files/figure-html/topo%20dist%20heatmap-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="additional-documentation-and-citations">Additional documentation and citations<a class="anchor" aria-label="anchor" href="#additional-documentation-and-citations"></a>
</h3>
<hr>
<table class="table">
<colgroup>
<col width="23%">
<col width="50%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Citation/URL</th>
<th>Details</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Associated code</td>
<td>terra (<a href="https://cran.r-project.org/web/packages/terra/index.html" class="external-link">Hijmans
2022</a>) and raster (<a href="https://cran.r-project.org/web/packages/raster/index.html" class="external-link">Hijmans
2022</a>)</td>
<td>algatr largely uses terra and raster packages to process and
manipulate environmental data</td>
</tr>
<tr class="even">
<td>Associated documentation</td>
<td>Walkthroughs for terra <a href="https://rspatial.org/terra/" class="external-link">here</a> and raster <a href="https://rspatial.org/raster/pkg/index.html" class="external-link">here</a>
</td>
<td></td>
</tr>
<tr class="odd">
<td>Associated code</td>
<td><a href="https://CRAN.R-project.org/package=geodist" class="external-link">Padgham &amp;
Sumner 2021</a></td>
<td>algatr uses the geodist package to calculate Euclidean
distances</td>
</tr>
<tr class="even">
<td>Associated code</td>
<td><a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13317" class="external-link">Wang
2020</a></td>
<td>algatr uses the topoDistance package to calculate topographic
distances</td>
</tr>
<tr class="odd">
<td>Associated code</td>
<td>
<a href="https://www.jstatsoft.org/article/view/v076i13" class="external-link">van Etten
2017</a>; vignette available <a href="http://127.0.0.1:20697/library/gdistance/doc/Overview.html" class="external-link">here</a>
</td>
<td>algatr uses the gdistance package to calculate resistance
distances</td>
</tr>
</tbody>
</table>
<p>Retrieve relevant vignettes:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"topoDistance-vignette"</span><span class="op">)</span></span>
<span><span class="co">#&gt; starting httpd help server ... done</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"geodist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: vignette 'geodist' not found</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Anusha Bishop, Anne Chambers, Ian Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
