<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="algatr">
<title>masking_vignette • algatr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="masking_vignette">
<meta property="og:description" content="algatr">
<meta property="og:image" content="https://thewanglab.github.io/algatr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">algatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/GDM_vignette.html">GDM_vignette</a>
    <a class="dropdown-item" href="../articles/LFMM_vignette.html">LFMM_vignette</a>
    <a class="dropdown-item" href="../articles/MMRR_vignette.html">MMRR_vignette</a>
    <a class="dropdown-item" href="../articles/Masking_vignette.html">masking_vignette</a>
    <a class="dropdown-item" href="../articles/RDA_vignette.html">RDA_vignette</a>
    <a class="dropdown-item" href="../articles/TESS_vignette.html">TESS_vignette</a>
    <a class="dropdown-item" href="../articles/alazygatr_vignette.html">alazygatr_vignette</a>
    <a class="dropdown-item" href="../articles/data_processing_vignette.html">data_processing_vignette</a>
    <a class="dropdown-item" href="../articles/enviro_data_vignette.html">Environmental_data_vignette</a>
    <a class="dropdown-item" href="../articles/gen_dist_vignette.html">gen_dist_vignette</a>
    <a class="dropdown-item" href="../articles/wingen_vignette.html">wingen-vignette</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>masking_vignette</h1>
            
      
      
      <div class="d-none name"><code>Masking_vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="masking-maps-for-landscape-genomics">Masking maps for landscape genomics<a class="anchor" aria-label="anchor" href="#masking-maps-for-landscape-genomics"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://thewanglab.github.io/algatr/">algatr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.55</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: viridisLite</span></span></code></pre></div>
<p>Often, we may want to mask areas of maps to visualize landscape
genomics results. For example, we may want to mask areas beyond a study
organism’s range, or in areas that are undersampled (or not sampled at
all). This allows users to avoid over-interpreting results from several
analyses where mapping is a useful visualization tool (e.g., generalized
dissimilarity modeling).</p>
<p>This vignette makes use of the following masking functions:</p>
<ul>
<li><p><code><a href="../reference/extrap_mask.html">extrap_mask()</a></code> function to reduce extrapolation by
masking areas that fall outside the data (either based on environmental
or spatial coverage)</p></li>
<li><p><code><a href="../reference/plot_extrap_mask.html">plot_extrap_mask()</a></code> generates a map with masked
areas</p></li>
<li><p><code><a href="../reference/rm_islands.html">rm_islands()</a></code> masks specified islands from
map</p></li>
</ul>
<div class="section level4">
<h4 id="read-in-data">Read in data<a class="anchor" aria-label="anchor" href="#read-in-data"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load test data, including CA_env which are the envlayers we'll be using</span></span>
<span><span class="fu"><a href="../reference/load_algatr_example.html">load_algatr_example</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; ---------------- example dataset ----------------</span></span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; </span> </span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt; Objects loaded:</span> </span></span>
<span><span class="co"><span style="color: #BBBB00; font-weight: bold;">#&gt; *liz_vcf*</span> <span style="color: #BBBB00;">vcfR object (1000 loci x 53 samples)</span> </span></span>
<span><span class="co"><span style="color: #BBBB00; font-weight: bold;">#&gt; *liz_gendist*</span> <span style="color: #BBBB00;">genetic distance matrix (Plink Distance)</span> </span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; *liz_coords*</span> <span style="color: #00BB00;">dataframe with x and y coordinates</span> </span></span>
<span><span class="co"><span style="color: #BB00BB; font-weight: bold;">#&gt; *CA_env*</span> <span style="color: #BB00BB;">RasterStack with PC environmental layers</span> </span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; -------------------------------------------------</span></span></span>
<span><span class="co"><span style="color: #00BBBB; font-weight: bold;">#&gt; </span></span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># For the purposes of simplicity, let's just use one of the PCs for mapping:</span></span>
<span><span class="va">envlayers</span> <span class="op">&lt;-</span> <span class="va">CA_env</span><span class="op">$</span><span class="va">CA_rPCA1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Let's take a look at the map with no masking:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">envlayers</span>, col <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/data-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="making-masked-maps">Making masked maps<a class="anchor" aria-label="anchor" href="#making-masked-maps"></a>
</h3>
<hr>
<div class="section level4">
<h4 id="make-a-range-based-based">Make a range-based based<a class="anchor" aria-label="anchor" href="#make-a-range-based-based"></a>
</h4>
<p>We can use the <code><a href="../reference/extrap_mask.html">extrap_mask()</a></code> function to mask all areas
outside range of environmental values included in data (the
<code>"range"</code> argument). This argument masks conservatively,
meaning that if any area falls outside the range of the data for any
variable, the area is masked.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extrapolate env values for given coordinates</span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"range"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span></span>
<span><span class="co"># Now, plot the map with masked areas</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB_cols <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/range%20mask-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Let's make the masked areas white with no transparency</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB_cols <span class="op">=</span> <span class="cn">FALSE</span>, mask_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/range%20mask-2.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="standard-deviation-based-mask">Standard deviation-based mask<a class="anchor" aria-label="anchor" href="#standard-deviation-based-mask"></a>
</h4>
<p>We can also mask using the <code>"sd"</code> argument, which masks
all areas outside of the mean, +/- some number of standard deviations
outside the environmental values included in data (normalized using the
<code>nsd</code> parameter). This method is still as conservative as the
<code>"range"</code> argument from above.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's start with nsd=2</span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"sd"</span>, nsd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/sd%20mask-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Now, increase nsd to 3 and see how the map masking changes:</span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"sd"</span>, nsd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/sd%20mask-2.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="buffer-based-mask">Buffer-based mask<a class="anchor" aria-label="anchor" href="#buffer-based-mask"></a>
</h4>
<p>We can mask all areas outside of a circular buffer of a fixed width
around the coordinates provided using the <code>"buffer"</code>
argument. Given how the buffer is calculated, this masking is agnostic
to environment. We can adjust the size of the circular buffer using the
<code>buffer_width</code> option.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"buffer"</span>, buffer_width <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="co">#&gt; Warning: [mask] CRS do not match</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/buffer%20mask-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Increase buffer size</span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"buffer"</span>, buffer_width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): [mask] CRS do not match</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/buffer%20mask-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Increase buffer size and change masking color and transparency</span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"buffer"</span>, buffer_width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): [mask] CRS do not match</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB <span class="op">=</span> <span class="cn">FALSE</span>, mask_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/buffer%20mask-3.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="convex-hull-based-mask">Convex hull-based mask<a class="anchor" aria-label="anchor" href="#convex-hull-based-mask"></a>
</h4>
<p>A convex hull describes the smallest convex polygon that contains
sets or points (in this case, sampling coordinates). We can mask all
areas outside of a convex hull around the coordinates provided using the
<code>"chull"</code> argument (this largely uses the
<code>st_convex_hull()</code> function in the sf package). As with the
buffer-based masking, this masking is also agnostic to environment, and
the size of the buffer is once again changed with the
<code>buffer_width</code> argument</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"chull"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/chull%20mask-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Increase the buffer size</span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"chull"</span>, buffer_width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/chull%20mask-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Increase the buffer size again</span></span>
<span><span class="va">map_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrap_mask.html">extrap_mask</a></span><span class="op">(</span><span class="va">liz_coords</span>, <span class="va">envlayers</span>, method <span class="op">=</span> <span class="st">"chull"</span>, buffer_width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in crs_check(coords, envlayers): No CRS found for the provided</span></span>
<span><span class="co">#&gt; coordinates. Make sure the coordinates and the raster have the same projection</span></span>
<span><span class="co">#&gt; (see function details or vignette)</span></span>
<span><span class="fu"><a href="../reference/plot_extrap_mask.html">plot_extrap_mask</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">map_mask</span>, RGB <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/chull%20mask-3.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="removing-islands-from-maps-using-rm_islands">Removing islands from maps using <code>rm_islands()</code><a class="anchor" aria-label="anchor" href="#removing-islands-from-maps-using-rm_islands"></a>
</h3>
<hr>
<p>In some cases, if we have no sampling from islands, we do not want
those areas mapped at all and can use the <code><a href="../reference/rm_islands.html">rm_islands()</a></code>
function to do so. For example, our example dataset does not include the
endemic <em>S. occidentalis</em> subspecies that occurs in the Channel
Islands in California, and thus, we may want to exclude the Channel
Islands from our maps. This function largely uses the
<code>ms_filter_islands()</code> function in the rmapshaper package,
which identifies islands based on them being small in size and detached
from the larger polygon (i.e., mainland). Users can specify the size of
the island to remove using the <code>min_vertices</code> argument, which
is the minimum number of vertices to retain.</p>
<div class="section level4">
<h4 id="retrieve-polygon">Retrieve polygon<a class="anchor" aria-label="anchor" href="#retrieve-polygon"></a>
</h4>
<p>First, let’s get the shape (polygon) for the state of California.
This will include the Channel Islands. We can retrieve administrative
boundaries using the <code>gadm()</code> function within the geodata
package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html" class="external-link">getData</a></span><span class="op">(</span><span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"United States"</span>, level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in getData("GADM", country = "United States", level = 1): getData will be removed in a future version of raster</span></span>
<span><span class="co">#&gt; . Please use the geodata package instead</span></span>
<span><span class="co"># states &lt;- gadm("United States", level = 1, path = here())</span></span>
<span><span class="va">cali</span> <span class="op">&lt;-</span> <span class="va">states</span><span class="op">[</span><span class="va">states</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"California"</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cali</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/cali%20polygon-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="remove-islands">Remove islands<a class="anchor" aria-label="anchor" href="#remove-islands"></a>
</h4>
<p>The <code><a href="../reference/rm_islands.html">rm_islands()</a></code> requires a polygon (in our case, the
state of California from above) and the environmental layers we want the
island(s) removed from (in our case, <code>CA_env</code> or
<code>envlayers</code>).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cali_noislands</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rm_islands.html">rm_islands</a></span><span class="op">(</span><span class="va">envlayers</span>, <span class="va">cali</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now, let's plot the env layer and see how it's removed the Channel Islands</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cali_noislands</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/remove%20islands-1.png" width="480" style="display: block; margin: auto;"></p>
<p>This function works even if we have multiple layers, as with
<code>CA_env</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cali_noislands</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rm_islands.html">rm_islands</a></span><span class="op">(</span><span class="va">CA_env</span>, <span class="va">cali</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Islands are gone from all three enviro PC layers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cali_noislands</span><span class="op">)</span></span></code></pre></div>
<p><img src="Masking_vignette_files/figure-html/remove%20islands%20multilayers-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Anusha Bishop, Anne Chambers, Ian Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
