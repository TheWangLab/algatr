---
title: "Environmental_data_vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Environmental_data_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

### Processing environmental data

```{r setup, warning = FALSE, message = FALSE}
library(algatr)
library(terra)
library(here)
library(viridis)
```

For landscape genomic analyses, environmental data layers must be processed. In particular, often environmental distances must be used as input for various analyses, or XXX

For our test dataset, and XXX, we will be using PC-based processing of environmental layers

(1) Import environmental layers
(2) Get PCs from them
(3) Calculate environmental distance

```{r data}
env_files <- list.files(here("inst", "extdata", "PC_layers"), full.names = TRUE)
envstack <- terra::rast(env_files)
```

Take a look at the rasters:

```{r plot rasters, fig.width = 5, fig.height = 5}
terra::plot(envstack, col = turbo(100), axes = FALSE)
```

```{r, RGB plot, fig.width = 5, fig.height = 6}
for(layer in 1:3){
  minval <- minmax(envstack[[layer]])[1,]
  maxval <- minmax(envstack[[layer]])[2,]
  
  envstack[[layer]] <- ((envstack[[layer]] - minval) / (maxval - minval))*255
}

terra::plotRGB(envstack, r = 1, g = 2, b = 3)
```

```{r}
env_files <- list.files(here("data","PC_layers"), full.names = TRUE)
envstack <- raster::stack(env_files)

# Scale rasters to get colors (each layer will correspond with R, G, or B in the final plot)
for(layer in 1:3){
    minval <- envstack[[layer]]@data@min
    maxval <- envstack[[layer]]@data@max
  
    envstack[[layer]] <- ((envstack[[layer]] - minval) / (maxval - minval))*255
  }

plotRGB(envstack, r = 1, g = 2, b = 3)

writeRaster(envstack, here("data",  "RGB_PC_stack.tif"), overwrite = TRUE)
```

Calculate environmental distance using the `env_dist()` function


